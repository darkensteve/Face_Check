<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Classes - FaceCheck</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <!-- Sidebar -->
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="w-64 bg-gray-800 text-white">
            <!-- Logo -->
            <div class="p-6 border-b border-gray-700">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-chalkboard-teacher text-white"></i>
                    </div>
                    <h1 class="text-xl font-bold">FaceCheck</h1>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="mt-6">
                <div class="px-3">
                    <div class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">Faculty Menu</div>
                </div>
                
                <a href="{{ url_for('faculty_dashboard') }}" class="flex items-center px-6 py-3 text-gray-300 hover:bg-gray-700 hover:text-white transition duration-200">
                    <i class="fas fa-tachometer-alt mr-3"></i>
                    Dashboard
                </a>
                
                <a href="/manage_students" class="flex items-center px-6 py-3 text-gray-300 hover:bg-gray-700 hover:text-white transition duration-200">
                    <i class="fas fa-users mr-3"></i>
                    Manage Students
                </a>
                
                <a href="/my_classes" class="flex items-center px-6 py-3 bg-gray-700 text-white">
                    <i class="fas fa-chalkboard mr-3"></i>
                    My Classes
                </a>
                
                <a href="/attendance" class="flex items-center px-6 py-3 text-gray-300 hover:bg-gray-700 hover:text-white transition duration-200">
                    <i class="fas fa-camera mr-3"></i>
                    Take Attendance
                </a>
                
                <a href="/attendance_reports" class="flex items-center px-6 py-3 text-gray-300 hover:bg-gray-700 hover:text-white transition duration-200">
                    <i class="fas fa-chart-line mr-3"></i>
                    Reports and Analytics
                </a>

                <a href="/faculty/register_face" class="flex items-center px-6 py-3 text-gray-300 hover:bg-gray-700 hover:text-white transition duration-200">
                    <i class="fas fa-user-plus mr-3"></i>
                    Register Face
                </a>
            </nav>
            
            <!-- User Info -->
            <div class="absolute bottom-0 w-64 p-6 border-t border-gray-700">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-user text-white text-sm"></i>
                    </div>
                    <div>
                        <div class="text-sm font-medium">Faculty</div>
                        <div class="text-xs text-gray-400">Professor</div>
                    </div>
                </div>
                <a href="{{ url_for('logout') }}" class="mt-3 flex items-center text-gray-300 hover:text-white transition duration-200">
                    <i class="fas fa-sign-out-alt mr-2"></i>
                    Logout
                </a>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Top Header -->
            <header class="bg-white shadow-sm border-b border-gray-200">
                <div class="px-6 py-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">My Classes & Events</h2>
                            <p class="text-gray-600">View your assigned classes and events</p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-clock mr-1"></i>
                                <span id="currentTime"></span>
                            </div>
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-calendar mr-1"></i>
                                <span id="currentDate"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="px-6 py-4">
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'error' if category == 'error' else 'success' }} bg-{{ 'red' if category == 'error' else 'green' }}-50 border border-{{ 'red' if category == 'error' else 'green' }}-200 text-{{ 'red' if category == 'error' else 'green' }}-800 px-4 py-3 rounded-lg mb-4">
                                <i class="fas fa-{{ 'exclamation-circle' if category == 'error' else 'check-circle' }} mr-2"></i>
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}
            
            <!-- Main Content Area -->
            <main class="flex-1 overflow-y-auto p-6">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-blue-100 rounded-lg">
                                <i class="fas fa-chalkboard text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Total Classes</p>
                                <p class="text-2xl font-bold text-gray-900">{{ classes|length }}</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-green-100 rounded-lg">
                                <i class="fas fa-calendar-alt text-green-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Total Events</p>
                                <p class="text-2xl font-bold text-gray-900">{{ events|length }}</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-purple-100 rounded-lg">
                                <i class="fas fa-users text-purple-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Total Students</p>
                                <p class="text-2xl font-bold text-gray-900" id="totalStudents">{{ total_students }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Classes Section -->
                <div class="bg-white rounded-xl shadow-lg mb-8">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-xl font-semibold text-gray-900">My Classes</h3>
                    </div>
                    <div class="p-6">
                        {% if classes %}
                        <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                            {% for class_info in classes %}
                            <div class="border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                                <div class="flex items-start justify-between mb-4">
                                    <div>
                                        <h4 class="text-lg font-semibold text-gray-900">{{ class_info.class_name }}</h4>
                                        <p class="text-sm text-gray-600">EDP: {{ class_info.edpcode }}</p>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button onclick="viewClassDetails({{ class_info.class_id }}, 'class')" class="text-blue-600 hover:text-blue-800">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="space-y-2 text-sm text-gray-600">
                                    <div class="flex items-center">
                                        <i class="fas fa-clock mr-2"></i>
                                        <span>{{ class_info.start_time }} - {{ class_info.end_time }}</span>
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-map-marker-alt mr-2"></i>
                                        <span>{{ class_info.room }}</span>
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-calendar-week mr-2"></i>
                                        <span>{{ class_info.days }}</span>
                                    </div>
                                </div>
                                
                                <div class="mt-4 pt-4 border-t border-gray-200">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-600">Students:</span>
                                        <span class="text-sm font-medium text-gray-900">{{ class_info.student_count }}</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-12">
                            <i class="fas fa-chalkboard text-gray-400 text-6xl mb-4"></i>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">No Classes Assigned</h3>
                            <p class="text-gray-600">You don't have any classes assigned yet.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Events Section -->
                <div class="bg-white rounded-xl shadow-lg">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-xl font-semibold text-gray-900">My Events</h3>
                    </div>
                    <div class="p-6">
                        {% if events %}
                        <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                            {% for event_info in events %}
                            <div class="border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                                <div class="flex items-start justify-between mb-4">
                                    <div>
                                        <h4 class="text-lg font-semibold text-gray-900">{{ event_info.event_name }}</h4>
                                        <p class="text-sm text-gray-600">{{ event_info.event_date }}</p>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button onclick="viewClassDetails({{ event_info.event_id }}, 'event')" class="text-blue-600 hover:text-blue-800">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                {% if event_info.description %}
                                <p class="text-sm text-gray-600 mb-4">{{ event_info.description }}</p>
                                {% endif %}
                                
                                <div class="space-y-2 text-sm text-gray-600">
                                    <div class="flex items-center">
                                        <i class="fas fa-clock mr-2"></i>
                                        <span>{{ event_info.start_time }} - {{ event_info.end_time }}</span>
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-map-marker-alt mr-2"></i>
                                        <span>{{ event_info.room }}</span>
                                    </div>
                                </div>
                                
                                <div class="mt-4 pt-4 border-t border-gray-200">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-600">Attendees:</span>
                                        <span class="text-sm font-medium text-gray-900">{{ event_info.attendee_count }}</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-12">
                            <i class="fas fa-calendar-alt text-gray-400 text-6xl mb-4"></i>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">No Events Assigned</h3>
                            <p class="text-gray-600">You don't have any events assigned yet.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Class/Event Details Modal -->
    <div id="detailsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900" id="modalTitle">Class Details</h3>
                        <button onclick="closeDetailsModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <div id="modalContent">
                        <!-- Content will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize elements
        document.addEventListener('DOMContentLoaded', function() {
            // Update time and date
            updateDateTime();
            setInterval(updateDateTime, 1000);
        });

        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            const dateString = now.toLocaleDateString();
            
            document.getElementById('currentTime').textContent = timeString;
            document.getElementById('currentDate').textContent = dateString;
        }

        // View class/event details
        async function viewClassDetails(id, type) {
            try {
                const response = await fetch(`/faculty/class-details/${type}/${id}`);
                if (response.ok) {
                    const data = await response.json();
                    displayDetails(data, type);
                } else {
                    showNotification('Error loading details', 'error');
                }
            } catch (error) {
                console.error('Error loading details:', error);
                showNotification('Error loading details', 'error');
            }
        }

        // Display details in modal
        function displayDetails(data, type) {
            const modal = document.getElementById('detailsModal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');
            
            if (type === 'class') {
                title.textContent = `${data.class_name} - Class Details`;
                content.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">Class Information</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Class Name</label>
                                    <p class="text-sm text-gray-900">${data.class_name}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">EDP Code</label>
                                    <p class="text-sm text-gray-900">${data.edpcode}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Schedule</label>
                                    <p class="text-sm text-gray-900">${data.start_time} - ${data.end_time}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Room</label>
                                    <p class="text-sm text-gray-900">${data.room}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Days</label>
                                    <p class="text-sm text-gray-900">${data.days}</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">Enrolled Students (${data.students.length})</h4>
                            <div class="max-h-64 overflow-y-auto">
                                ${data.students.length > 0 ? `
                                    <div class="space-y-2">
                                        ${data.students.map(student => `
                                            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                                <div>
                                                    <p class="text-sm font-medium text-gray-900">${student.firstname} ${student.lastname}</p>
                                                    <p class="text-xs text-gray-600">ID: ${student.idno}</p>
                                                </div>
                                                <div class="text-right">
                                                    <p class="text-xs text-gray-600">${student.course_name || 'N/A'}</p>
                                                    <p class="text-xs text-gray-600">Year ${student.year_level}</p>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : `
                                    <p class="text-sm text-gray-600">No students enrolled in this class.</p>
                                `}
                            </div>
                        </div>
                    </div>
                `;
            } else {
                title.textContent = `${data.event_name} - Event Details`;
                content.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">Event Information</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Event Name</label>
                                    <p class="text-sm text-gray-900">${data.event_name}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Date</label>
                                    <p class="text-sm text-gray-900">${data.event_date}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Schedule</label>
                                    <p class="text-sm text-gray-900">${data.start_time} - ${data.end_time}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Room</label>
                                    <p class="text-sm text-gray-900">${data.room}</p>
                                </div>
                                ${data.description ? `
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Description</label>
                                    <p class="text-sm text-gray-900">${data.description}</p>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">Event Attendees (${data.attendees.length})</h4>
                            <div class="max-h-64 overflow-y-auto">
                                ${data.attendees.length > 0 ? `
                                    <div class="space-y-2">
                                        ${data.attendees.map(attendee => `
                                            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                                <div>
                                                    <p class="text-sm font-medium text-gray-900">${attendee.firstname} ${attendee.lastname}</p>
                                                    <p class="text-xs text-gray-600">ID: ${attendee.idno}</p>
                                                </div>
                                                <div class="text-right">
                                                    <p class="text-xs text-gray-600">${attendee.course_name || 'N/A'}</p>
                                                    <p class="text-xs text-gray-600">Year ${attendee.year_level}</p>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : `
                                    <p class="text-sm text-gray-600">No attendees for this event.</p>
                                `}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            modal.classList.remove('hidden');
        }

        // Close details modal
        function closeDetailsModal() {
            document.getElementById('detailsModal').classList.add('hidden');
        }

        // Show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check' : 'exclamation'}-circle mr-2"></i>
                    ${message}
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>
